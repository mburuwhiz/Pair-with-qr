<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WHIZ-MD - QR Scanner</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="animated-bg"></div>

  <div id="app">
    <div class="container">
      <div class="header">
        <h1>Scan QR to Link</h1>
        <p>Use WhatsApp to scan and link your WHIZ-MD session</p>
      </div>

      <div class="qr-container">
        <div class="qr-wrapper">
          <img id="qrcode" src="/qr" alt="QR Code" />
        </div>

        <div class="timer-container">
          <div class="timer-circle">
            <svg class="timer-svg">
              <circle class="timer-bg" cx="60" cy="60" r="50"></circle>
              <circle class="timer-progress" cx="60" cy="60" r="50"></circle>
            </svg>
            <div class="timer-text" id="time">30</div>
          </div>
          <div class="timer-label">Expires in <span id="time-label">seconds</span></div>
        </div>
      </div>

      <div class="expired-message" id="expired">
        <h2>QR Code Expired</h2>
        <p>Your QR Code has expired. Please refresh the page to get a new one.</p>
        <button class="reload-btn" onclick="reloadPage()">ðŸ”„ Reload QR</button>
      </div>

      <div class="instructions">
        <h3>How to Connect:</h3>
        <ol>
          <li>Open <strong>WhatsApp</strong> on your phone</li>
          <li>Go to <strong>Linked Devices</strong></li>
          <li>Tap <strong>Link a Device</strong></li>
          <li>Scan the QR code on this screen</li>
        </ol>
      </div>
    </div>
  </div>

  <script>
    function reloadPage() {
      document.querySelector('.reload-btn').innerText = "Reloading...";
      setTimeout(() => location.reload(), 500);
    }

    const timeText = document.getElementById('time');
    const progressCircle = document.querySelector('.timer-progress');
    const expiredBox = document.getElementById('expired');
    let timeLeft = 30;
    const radius = 50;
    const circumference = 2 * Math.PI * radius;

    progressCircle.style.strokeDasharray = circumference;
    progressCircle.style.strokeDashoffset = 0;

    const timer = setInterval(() => {
      timeLeft--;
      timeText.textContent = timeLeft;
      const offset = circumference - (timeLeft / 30) * circumference;
      progressCircle.style.strokeDashoffset = offset;

      if (timeLeft <= 0) {
        clearInterval(timer);
        document.querySelector('.qr-wrapper').style.display = 'none';
        expiredBox.classList.add('show');
      }
    }, 1000);
  </script>
</body>
</html>
