<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>WHIZ-MD QR Scanner</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="animated-bg"></div>
  <div class="overlay">
    <div class="container">
      <h1 class="title">WHIZ-MD QR Login</h1>
      <p class="subtitle">Scan to link WhatsApp securely</p>

      <div class="qr-box">
        <div class="qr-loader" id="loader">
          <div class="spinner"></div>
          <p class="loading-text">Loading QR Code...</p>
        </div>

        <img id="qrcode" src="/qr" alt="QR Code" class="qr-img" style="display:none;" />

        <div class="timer-container" id="timerContainer" style="display:none;">
          <div class="timer-circle">
            <svg class="timer-svg" width="120" height="120">
              <circle class="timer-bg" cx="60" cy="60" r="50" />
              <circle class="timer-progress" cx="60" cy="60" r="50" />
            </svg>
            <div class="timer-text" id="time">30</div>
          </div>
          <p class="timer-label">Time left</p>
        </div>

        <div class="expired-message" id="expired">
          <h2>‚è≥ QR Expired</h2>
          <button class="reload-btn" onclick="reloadPage()">üîÑ Reload</button>
        </div>
      </div>

      <div class="instructions">
        <h3>How to Link WhatsApp</h3>
        <ol>
          <li>Open WhatsApp on your phone</li>
          <li>Tap <strong>Menu</strong> > <strong>Linked Devices</strong></li>
          <li>Select <strong>Link a Device</strong></li>
          <li>Point your camera to this QR</li>
        </ol>
      </div>
    </div>
  </div>

  <script>
    function reloadPage() {
      document.querySelector('.reload-btn').innerText = "Reloading...";
      setTimeout(() => location.reload(), 300);
    }

    const qrImage = document.getElementById('qrcode');
    const loader = document.getElementById('loader');
    const timerBox = document.getElementById('timerContainer');
    const expired = document.getElementById('expired');
    const timeText = document.getElementById('time');
    const progress = document.querySelector('.timer-progress');
    let timeLeft = 30;
    const radius = 50;
    const circumference = 2 * Math.PI * radius;

    progress.style.strokeDasharray = circumference;

    qrImage.onload = () => {
      loader.style.display = 'none';
      qrImage.style.display = 'block';
      timerBox.style.display = 'block';

      const interval = setInterval(() => {
        timeLeft--;
        timeText.textContent = timeLeft;
        progress.style.strokeDashoffset = circumference - (timeLeft / 30) * circumference;

        if (timeLeft <= 0) {
          clearInterval(interval);
          qrImage.style.display = 'none';
          timerBox.style.display = 'none';
          expired.classList.add('show');
        }
      }, 1000);
    };

    qrImage.onerror = () => {
      loader.innerHTML = "<p>‚ùå Failed to load QR. Click reload.</p>";
    };
  </script>
</body>
</html>
