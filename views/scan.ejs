<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WHIZ-MD | QR Code Scanner</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="animated-bg"></div>

  <div id="app">
    <div class="container">
      <div class="header">
        <h1>WHIZ-MD</h1>
        <p>Scan QR Code to Connect Your WhatsApp</p>
      </div>

      <div class="qr-container">
        <div class="qr-wrapper">
          <img id="qrcode" src="/qr" alt="QR Code" />
        </div>

        <div class="timer-container">
          <div class="timer-circle">
            <svg class="timer-svg" width="120" height="120">
              <circle class="timer-bg" cx="60" cy="60" r="50" />
              <circle class="timer-progress" cx="60" cy="60" r="50" />
            </svg>
            <div class="timer-text" id="time">30</div>
          </div>
          <div class="timer-label">QR Expires In</div>
        </div>
      </div>

      <div class="expired-message" id="expired">
        <h2>‚è≥ QR Code Expired</h2>
        <p>Your session QR code has expired. Click below to reload and get a new one.</p>
        <button class="reload-btn" onclick="reloadPage()">üîÑ Reload QR</button>
      </div>

      <div class="instructions">
        <h3>üì± How to Use</h3>
        <ol>
          <li>Open WhatsApp on your phone</li>
          <li>Go to Settings ‚Üí Linked Devices</li>
          <li>Tap on ‚ÄúLink a Device‚Äù</li>
          <li>Scan the QR code shown above</li>
        </ol>
      </div>
    </div>
  </div>

  <script>
    function reloadPage() {
      document.querySelector('.reload-btn').innerText = "Reloading...";
      setTimeout(() => location.reload(), 500);
    }

    const timeText = document.getElementById('time');
    const progressCircle = document.querySelector('.timer-progress');
    const expiredBox = document.getElementById('expired');
    const qrImage = document.getElementById('qrcode');
    let timeLeft = 30;
    const radius = 50;
    const circumference = 2 * Math.PI * radius;

    progressCircle.style.strokeDasharray = circumference;
    progressCircle.style.strokeDashoffset = 0;

    // Animate countdown
    const timer = setInterval(() => {
      timeLeft--;
      timeText.textContent = timeLeft;
      const offset = circumference - (timeLeft / 30) * circumference;
      progressCircle.style.strokeDashoffset = offset;

      if (timeLeft <= 0) {
        clearInterval(timer);
        qrImage.style.display = 'none';
        expiredBox.classList.add('show');
      }
    }, 1000);

    qrImage.onload = () => {
      console.log("‚úÖ QR Code loaded successfully.");
      qrImage.alt = "WHIZ-MD QR Code";
    };

    qrImage.onerror = () => {
      console.warn("‚ö†Ô∏è Failed to load QR Code.");
      qrImage.style.display = 'none';
      expiredBox.innerHTML = `
        <h2>QR Code Failed</h2>
        <p>We couldn't load the QR. Please check server or reload.</p>
        <button class="reload-btn" onclick="reloadPage()">üîÑ Try Again</button>
      `;
      expiredBox.classList.add('show');
    };
  </script>
</body>
</html>
